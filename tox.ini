[tox]
envlist =
    debug

[gh-actions]
# See https://pypi.org/project/tox-gh-actions/
python =
    3.8: py38
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312

[testenv]
skip_install = true
allowlist_externals =
    echo
    false
commands =
    echo "Unrecognized environment name {envname}"
    false

[testenv:init]
description = Prepare environment
skip_install = true
deps =
    mxdev
commands =
    mxdev -c mx-{env:PLONE-VERSION}.ini
    echo "Initial setup for mxdev"


[testenv:debug]
description = automatically reformat code
skip_install = true
deps =
    pre-commit
commands =
    python --version
    echo {env:PLONE-VERSION}

[testenv:test]
description = run the distribution tests
use_develop = true
skip_install = false
constrain_package_deps = false
set_env =
    ROBOT_BROWSER=headlesschrome

deps =
    zope.testrunner
    -c constraints-{env:PLONE-VERSION}-mxdev.txt

commands =
    zope-testrunner --test-path={toxinidir}/src -s my.addon {posargs}

extras =
    test